<!DOCTYPE html>
<html>
  <head>
    <title>React Basics</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="js-container w-full max-w-md"></div>

    <script src="https://unpkg.com/supersimpledev@3.2.1/external-library.js"></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>

    <script type="text/babel">
      // Main App component
      function App() {
        const [messages, setMessages] = React.useState([
          { id: 1, message: "hello chatbot", sender: "user" },
          { id: 2, message: "Hello! How can I help you?", sender: "robot" },
          { id: 3, message: "can you get me today date?", sender: "user" },
          { id: 4, message: "Today is December 13", sender: "robot" },
        ]);

        // Where components are displayed
        return (
          <div className="bg-white shadow-xl rounded-2xl overflow-hidden flex flex-col h-[550px] border border-gray-200">
            <div className="bg-blue-600 p-4 text-white font-bold text-center shadow-sm">
              Chatbot Assistant
            </div>

            <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">
              <ChatMessages messages={messages} />
            </div>

            <div className="p-4 border-t bg-white">
              <ChatInput messages={messages} setMessages={setMessages} />
            </div>
          </div>
        );
      }

      // Display chat messages through iteration
      function ChatMessages({ messages }) {
        return (
          <>
            {messages.map((message) => {
              return (
                <ChatMsg
                  message={message.message}
                  sender={message.sender}
                  key={message.id}
                />
              );
            })}
          </>
        );
      }

      // Conditional rendering based on sender
      function ChatMsg({ message, sender }) {
        const isRobot = sender === "robot";
        return (
          <div
            className={`flex ${
              isRobot ? "justify-start" : "justify-end"
            } items-end gap-2`}
          >
            {sender === "robot" && (
              <img
                src="assets/robot.png"
                className="w-8 h-8 rounded-full border border-gray-200"
              />
            )}

            <div
              className={`max-w-[80%] p-3 rounded-2xl text-sm ${
                isRobot
                  ? "bg-white border border-gray-200 text-gray-800 rounded-bl-none"
                  : "bg-blue-600 text-white rounded-br-none"
              }`}
            >
              {message}
            </div>

            {sender === "user" && (
              <img
                src="assets/user.png"
                className="w-8 h-8 rounded-full border border-gray-200"
              />
            )}
          </div>
        );
      }

      // Input Component
      function ChatInput({ messages, setMessages }) {
        const [input, setInput] = React.useState("");

        // Sending message logic
        function sendMessage() {
          if (input.trim() === "") return;

          // Accpet messages from user
          const newChatMessage = [
            ...messages,
            { message: input, sender: "user", id: crypto.randomUUID() },
          ];

          // Update messages state
          setMessages(newChatMessage);

          // Get response from External Library Chatbot
          const response = Chatbot.getResponse(input);

          // Update messages state with chatbot response
          setMessages([
            ...newChatMessage,
            { message: response, sender: "robot", id: crypto.randomUUID() },
          ]);

          // Clear input field after sending
          setInput("");
        }

        // Handle key events for Enter and Escape
        const saveInput = (event) => {
          if (event.key === "Enter") {
            sendMessage();
          } else if (event.key === "Escape") {
            setInput("");
          }
        };

        return (
          <div className="flex gap-2">
            <input
              className="flex-1 border border-gray-300 rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
              placeholder="Send a message to Chatbot"
              onChange={(event) => setInput(event.target.value)}
              value={input}
              onKeyDown={saveInput}
            />
            <button
              className="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-full text-sm font-medium transition-colors"
              onClick={sendMessage}
            >
              Send
            </button>
          </div>
        );
      }

      const container = document.querySelector(".js-container");
      ReactDOM.createRoot(container).render(<App />);
    </script>
  </body>
</html>
